<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ title }}</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='Import/results.css') }}">
    <style>
        th {
            cursor: pointer;
        }

        th.sort-asc::after {
            content: " ⬆️"; /* Up arrow */
            font-size: 0.8rem;
        }

        th.sort-desc::after {
            content: " ⬇️"; /* Down arrow */
            font-size: 0.8rem;
        }
    </style>
</head>
<body>
    {% include 'taskbar.html' %}
    <div class="container mt-4">
        <h1>{{ title }}</h1>
        <h3>{{ explanation }}</h3>

        <table id="resultsTable">
            <thead>
                <tr>
                    <th onclick="sortTable(0, this)">ConsignmentID</th>
                    <th onclick="sortTable(1, this)">SupplierRef</th>
                    <th onclick="sortTable(2, this)">Product</th>
                    <th onclick="sortTable(3, this)">Variety</th>
                    <th onclick="sortTable(4, this)">Size</th>
                    <th onclick="sortTable(5, this)">Class</th>
                    <th onclick="sortTable(6, this)">Mass (kg)</th>
                    <th onclick="sortTable(7, this)">Qty Sold</th>
                    <th onclick="sortTable(8, this)">Price</th>
                    <th onclick="sortTable(9, this)">Qty Sent</th>
                    {% if no_matches %}
                        <th onclick="sortTable(10, this)">Has Header</th>
                    {% endif %}
                </tr>
            </thead>
            <tbody>
                {% for result in results %}
                    {% if no_matches and result[10] %}
                        <tr class="clickable-row" onclick="window.location='{{ url_for('import.manual_matching', consignment_id=result[0]) }}'">
                    {% else %}
                        <tr>
                    {% endif %}
                    
                        <td>{{ result[0] }}</td>
                        <td>{{ result[1] }}</td>
                        <td>{{ result[2] }}</td>
                        <td>{{ result[3] }}</td>
                        <td>{{ result[4] }}</td>
                        <td>{{ result[5] }}</td>
                        <td>{{ result[6] }}</td>
                        <td>{{ result[7] }}</td>
                        <td>{{ result[8] }}</td>
                        <td>{{ result[9] }}</td>
                        {% if no_matches %}
                            <td>{{ result[10] }}</td>
                        {% endif %}
                    </tr>
                {% endfor %}
            </tbody>            

        <a href="{{ url_for('import.import_page') }}" class="btn btn-primary mt-4">Back to Import Page</a>
    </div>

    <script>
        function sortTable(columnIndex, header) {
            const table = document.getElementById("resultsTable");
            const rows = Array.from(table.rows).slice(1); // Exclude the header row
            const isAscending = header.classList.contains("sort-asc");
            const sortMultiplier = isAscending ? -1 : 1;

            // Remove sort classes from all headers
            Array.from(table.tHead.rows[0].cells).forEach(th => th.classList.remove("sort-asc", "sort-desc"));

            // Sort rows
            rows.sort((rowA, rowB) => {
                const cellA = rowA.cells[columnIndex].innerText.trim();
                const cellB = rowB.cells[columnIndex].innerText.trim();

                if (!isNaN(cellA) && !isNaN(cellB)) {
                    return sortMultiplier * (parseFloat(cellA) - parseFloat(cellB));
                }
                return sortMultiplier * cellA.localeCompare(cellB);
            });

            // Append sorted rows back to the table body
            rows.forEach(row => table.tBodies[0].appendChild(row));

            // Update sort order and add appropriate class to header
            if (isAscending) {
                header.classList.remove("sort-asc");
                header.classList.add("sort-desc");
            } else {
                header.classList.remove("sort-desc");
                header.classList.add("sort-asc");
            }
        }
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
